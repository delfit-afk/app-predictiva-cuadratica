#cd "C:\App predictiva cuadratica"
#>> streamlit run app_fixed.py



import io
import numpy as np
import pandas as pd
import streamlit as st
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestRegressor

# ============================================================
#  CSV EMBEBIDO (tal cual me lo pasaste)

# ============================================================

CSV_DATA = """Fecha,Hora,"Alc, (mg/l)",Cloruros (mg/l),"Cond, (ÂµS)",pH,TDS (ppm),Temp (Â°C),"Turb, (NTU)",Caudal (mÂ³/h),Dosis (ppm),Prom Turb Decant,"Turb filtrada, (NTU)",Remoc decant (%),Remoc total (%),Turb Cruda Ref (NTU)
2023-12-14 00:00:00,,31,9,,7.12,,25,51.7,9047,27,1.36,0.218,"97,37 %","99,58 %",51.7
2023-12-15 00:00:00,,28,8,80.72,7.01,40.37,25.2,39.2,,,1.43,0.215,"96,35 %","99,45 %",39.2
2023-12-19 00:00:00,,32,5,77.76,7.16,38.89,23.5,89,9035,30,5.734999999999999,0.231,"93,56 %","99,74 %",89
2023-12-20 00:00:00,,36,7,75.81,7.11,37.92,24.3,50.1,9000,30,1.855,0.203,"96,30 %","99,59 %",50.1
2023-12-21 00:00:00,,28,7,82.54,7.14,41.3,25.8,35.7,8972,27.5,1.29,0.23,"96,39 %","99,36 %",35.7
2023-12-22 00:00:00,,32,5,83.69,7.04,41.82,25.1,27,8995,27,1.48,0.177,"94,52 %","99,34 %",27
2024-01-02 00:00:00,,36,5,88.59,7.21,44.28,26.4,34.3,9112,27,1.57,0.271,"95,42 %","99,21 %",34.3
2024-01-03 00:00:00,,26,5,112.3,7.5,56.17,26.6,31.9,,30,1.8,0.2,"94,36 %","99,37 %",31.9
2024-01-04 00:00:00,1899-12-30 06:30:00,28,5,86.1,6.85,43.05,27.1,34.1,,30,1.315,0.302,"96,14 %","99,11 %",34.1
2024-01-05 00:00:00,1899-12-30 06:35:00,28,7,87.84,6.8,43.92,,43.3,,30,1.4249999999999998,0.28,"96,71 %","99,35 %",43.3
2024-01-08 00:00:00,,28,3,91.13,7.05,45.57,27.1,44,9067,30,1.03,0.211,"97,66 %","99,52 %",44
2024-01-09 00:00:00,1899-12-30 06:35:00,34,11,91.75,6.54,45.87,27.2,51.6,9050,30,1.44,0.255,"97,21 %","99,51 %",51.6
2024-01-10 00:00:00,1899-12-30 06:35:00,32,7,92.3,6.9,46.16,27.3,60.1,8612,30,1.19,0.207,"98,02 %","99,66 %",60.1
2024-01-11 00:00:00,1899-12-30 06:35:00,30,7,89.26,6.95,44.62,26.6,32.5,8600,30,1.16,0.247,"96,43 %","99,24 %",32.5
2024-01-12 00:00:00,1899-12-30 08:30:00,30,8,86.84,6.94,43.5,25.7,38.6,8600,30,1.335,0.264,"96,54 %","99,32 %",38.6
2024-01-13 00:00:00,1899-12-30 08:30:00,30,8,,6.93,,25.9,70,8680,30,1.655,0.497,"97,64 %","99,29 %",70
2024-01-14 00:00:00,1899-12-30 07:30:00,30,9,87.78,6.95,43.89,,72.5,8689,30,1.395,0.29,"98,08 %","99,60 %",72.5
2024-01-15 00:00:00,1899-12-30 06:30:00,30,9,92.64,6.98,46.33,26.1,90.2,8680,30,1.3050000000000002,0.26,"98,55 %","99,71 %",90.2
2024-01-16 00:00:00,1899-12-30 06:35:00,30,9,95.16,6.99,47.59,27.5,79.9,8600,30,1.225,0.221,"98,47 %","99,72 %",79.9
2024-01-17 00:00:00,1899-12-30 06:40:00,30,9,96.75,7.04,48.38,25.4,140,8630,30,2.43,0.303,"98,26 %","99,78 %",140
2024-01-18 00:00:00,1899-12-30 06:35:00,30,9,90.48,7,45.25,25.7,95.2,8675,32,1.45,0.31,"98,48 %","99,67 %",95.2
2024-01-19 00:00:00,1899-12-30 06:35:00,30,8,91.75,6.98,45.84,26.9,91.9,,32,1.21,0.256,"98,68 %","99,72 %",91.9
2024-01-22 00:00:00,,38,7,91.95,7.11,45.97,26.2,71.7,8768,32,1.05,0.181,"98,54 %","99,75 %",71.7
2024-01-23 00:00:00,1899-12-30 06:35:00,32,7,92.67,7.02,46.35,25.8,82.8,8759,32,1.17,0.222,"98,59 %","99,73 %",82.8
2024-01-24 00:00:00,1899-12-30 06:30:00,30,7,93.38,7,46.9,25.5,77.6,8772,32,1.21,0.241,"98,44 %","99,69 %",77.6
2024-01-25 00:00:00,1899-12-30 06:30:00,32,7,93.44,7.09,46.73,26,74,8789,32,1.1,0.216,"98,51 %","99,71 %",74
2024-01-26 00:00:00,1899-12-30 06:25:00,32,7,92.35,7.13,46.18,25.6,69.5,8792,32,1.2000000000000002,0.2,"98,27 %","99,71 %",69.5
2024-01-27 00:00:00,1899-12-30 07:30:00,30,7,93.61,7.13,46.81,26.4,64.2,,32,1.2000000000000002,0.276,"98,13 %","99,57 %",64.2
2024-01-28 00:00:00,1899-12-30 07:40:00,30,7,94.42,7.1,47.28,26.6,62.5,8792,30,1.1,0.289,"98,24 %","99,54 %",62.5
2024-01-29 00:00:00,1899-12-30 06:25:00,30,6,94.36,7.16,47.18,26.5,62.3,8759,31,1.8199999999999998,0.236,"97,08 %","99,62 %",62.3
2024-01-30 00:00:00,1899-12-30 07:05:00,30,6,93.18,7.13,46.58,26.9,57.6,,31,1.2999999999999998,0.239,"97,74 %","99,59 %",57.6
2024-01-31 00:00:00,1899-12-30 06:25:00,29,7,95.74,7.06,47.87,28.3,51.5,8769,31,1.15,0.296,"97,77 %","99,43 %",51.5
2024-02-01 00:00:00,1899-12-30 06:25:00,30,7,92.08,7.13,46.05,28.5,50.9,8770,30,1.12,0.237,"97,80 %","99,53 %",50.9
2024-02-05 00:00:00,,42,7,107.2,7.18,53.59,28.3,74.7,8901,30,1.035,0.23,"98,61 %","99,69 %",74.7
2024-02-06 00:00:00,1899-12-30 06:25:00,34,7,112.2,7.1,56.17,29.5,87.1,,32,1.2,0.18,"98,62 %","99,79 %",87.1
2024-02-07 00:00:00,1899-12-30 06:45:00,34,7,113.2,7.17,56.59,30.4,109,8792,32,1.07,0.21,"99,02 %","99,81 %",109
2024-02-08 00:00:00,1899-12-30 06:25:00,34,8,113.2,6.98,56.64,31.1,113,8769,32,1.1,0.256,"99,03 %","99,77 %",113
2024-02-09 00:00:00,1899-12-30 06:40:00,34,9,113.2,7.18,56.61,30.3,129.7,8770,32,1.145,0.26,"99,12 %","99,80 %",129.7
2024-02-10 00:00:00,1899-12-30 06:50:00,29,9,110,7.15,55.41,30.1,135,,32,1.158,0.252,"99,14 %","99,81 %",135
2024-02-12 00:00:00,1899-12-30 07:30:00,32,9,115,7.03,57.52,30.2,143.6,8781,32,1.19,0.246,"99,17 %","99,83 %",143.6
2024-02-13 00:00:00,1899-12-30 08:00:00,36,9,112.9,7.14,56.45,26.3,16.3,8792,32,1.1909999999999998,0.21,"92,69 %","98,71 %",16.3
2024-02-14 00:00:00,1899-12-30 06:40:00,36,9,112,7.12,56,26.7,166,8780,32,1.145,0.22,"99,31 %","99,87 %",166
2024-02-15 00:00:00,1899-12-30 08:10:00,34,9,108.9,7.16,54.44,26.2,156,8810,33,1.2850000000000001,0.23,"99,18 %","99,85 %",156
2024-02-16 00:00:00,1899-12-30 07:50:00,34,9,107.6,7.05,53.81,26.2,137,,33,1.44,0.246,"98,95 %","99,82 %",137
2024-02-19 00:00:00,,30,7,106.1,7.42,53.22,26.6,87.2,,34,1.44,0.16,"98,35 %","99,82 %",87.2
2024-02-20 00:00:00,1899-12-30 06:30:00,34,10,103.2,7.4,51.61,27.6,102.5,8900,34,1.54,0.396,"98,50 %","99,61 %",102.5
2024-02-21 00:00:00,1899-12-30 06:30:00,32,11,95.56,7.13,44.77,26.9,94,8900,33,1.645,0.22,"98,25 %","99,77 %",94
2024-02-22 00:00:00,1899-12-30 06:30:00,32,11,98.21,7.17,49.11,27.1,83,8900,33,1.99,0.256,"97,60 %","99,69 %",83
2024-02-23 00:00:00,1899-12-30 06:15:00,32,7,97.15,7.28,48.58,28.4,8.6,9100,32,1.63,0.217,"81,05 %","97,48 %",8.6
2024-02-24 00:00:00,1899-12-30 07:30:00,32,7,97.08,7.2,48.54,26.8,85.7,9200,32,1.715,0.229,"98,00 %","99,73 %",85.7
2024-02-26 00:00:00,1899-12-30 06:30:00,38,11,110,7.1,50.35,25.7,118,9250,32,1.13,0.201,"99,04 %","99,83 %",118
2024-02-27 00:00:00,1899-12-30 06:30:00,32,10,105.8,7.15,52.93,27.2,117,9250,32,1.3,0.196,"98,89 %","99,83 %",117
2024-02-28 00:00:00,1899-12-30 06:30:00,34,10,106.5,7.13,53.5,27.1,134,8400,32,1.28,0.239,"99,04 %","99,82 %",134
2024-02-29 00:00:00,1899-12-30 06:25:00,34,7,107,7.11,53.5,27.3,143,9250,32,1.56,0.221,"98,91 %","99,85 %",143
2024-03-01 00:00:00,1899-12-30 06:25:00,34,11,104.6,7.08,52.22,27.1,152.9,9250,32,1.44,0.25,"99,06 %","99,84 %",152.9
2024-03-04 00:00:00,,38,11,86.66,7.68,43.5,24.3,180,9174,30,1.1749999999999998,0.111,"99,35 %","99,94 %",180
2024-03-05 00:00:00,1899-12-30 06:40:00,36,9,105.5,7.27,52.75,25,230,9200,33,1.295,0.2,"99,44 %","99,91 %",230
2024-03-06 00:00:00,1899-12-30 06:40:00,36,9,111.9,7.25,55.97,25,259,9169,33,1.46,0.18,"99,44 %","99,93 %",259
2024-03-07 00:00:00,1899-12-30 07:30:00,36,10,111.5,7.13,55.74,25.7,266,9170,25,1.47,0.19,"99,45 %","99,93 %",266
2024-03-08 00:00:00,1899-12-30 07:10:00,36,8,110.3,7.22,55.14,26.6,225,8230,35,1.52,0.246,"99,32 %","99,89 %",225
2024-03-09 00:00:00,1899-12-30 07:10:00,36,9,106.7,7.23,53.4,26.3,191,8320,32,1.495,0.231,"99,22 %","99,88 %",191
2024-03-11 00:00:00,1899-12-30 07:10:00,36,11,110.3,7.19,55.17,28.4,207,8300,32,1.45,0.267,"99,30 %","99,87 %",207
2024-03-12 00:00:00,1899-12-30 06:40:00,36,7,112,7.22,56,29.6,202,8295,32,1.4100000000000001,0.231,"99,30 %","99,89 %",202
2024-03-13 00:00:00,1899-12-30 06:40:00,36,7,119.7,7.27,59.84,28.5,197,8300,32,1.38,0.272,"99,30 %","99,86 %",197
2024-03-14 00:00:00,1899-12-30 06:40:00,38,11,125.4,7.19,62.69,29,183,8600,32,1.2200000000000002,0.237,"99,33 %","99,87 %",183
2024-03-15 00:00:00,1899-12-30 06:40:00,38,12,113.2,7.45,56.63,26.6,157,8592,32,1.365,0.209,"99,13 %","99,87 %",157
2024-03-18 00:00:00,,36,10,115.9,7.5,57.98,26.2,174,8509,32,1.2,0.256,"99,31 %","99,85 %",174
2024-03-19 00:00:00,1899-12-30 06:30:00,38,9,105.6,7.34,52.58,27.4,222,,32,1.63,0.208,"99,27 %","99,91 %",222
2024-03-20 00:00:00,1899-12-30 06:30:00,38,9,120.9,7.18,60.33,27.5,224,,35,1.1400000000000001,0.221,"99,49 %","99,90 %",224
2024-03-21 00:00:00,1899-12-30 06:30:00,38,10,110.2,7.22,54.81,26.2,222,8500,35,1.205,0.221,"99,46 %","99,90 %",222
2024-03-22 00:00:00,,33,13,114.5,7.54,57.16,23.8,199,8378,35,1.16,0.144,"99,42 %","99,93 %",199
2024-03-23 00:00:00,1899-12-30 07:15:00,38,11,105.6,7.31,52.8,24,195,8442,35,1.79,0.396,"99,08 %","99,80 %",195
2024-03-24 00:00:00,1899-12-30 07:20:00,38,12,112.3,7.22,36.09,25.9,210,,35,1.375,0.285,"99,35 %","99,86 %",210
2024-03-25 00:00:00,1899-12-30 06:35:00,40,9,113.8,7.3,56.91,25.1,200,8445,35,1.365,0.191,"99,32 %","99,90 %",200
2024-03-26 00:00:00,1899-12-30 06:40:00,40,9,122.6,7.23,61.31,25.2,204,8453,35,1.445,0.223,"99,29 %","99,89 %",204
2024-03-27 00:00:00,1899-12-30 07:00:00,40,11,135.4,7.25,67.69,25.1,215,8450,35,1.46,0.23,"99,32 %","99,89 %",215
2024-04-03 00:00:00,1899-12-30 06:25:00,40,11,121.3,7.22,60.65,23.8,167,8520,35,1.4700000000000002,0.2,"99,12 %","99,88 %",167
2024-04-04 00:00:00,1899-12-30 06:30:00,40,11,122.8,7.19,61.41,22.9,178,8550,35,1.6099999999999999,0.175,"99,10 %","99,90 %",178
2024-04-05 00:00:00,,40,9,118.8,7.25,59.41,23.2,175,,35,1.4500000000000002,0.201,"99,17 %","99,89 %",175
2024-04-06 00:00:00,1899-12-30 07:30:00,40,9,121.2,7.24,60.58,23,171,8200,35,1.49,0.257,"99,13 %","99,85 %",171
2024-04-07 00:00:00,1899-12-30 07:45:00,40,9,123.2,7.26,61.82,22.9,205,8182,35,1.6099999999999999,0.266,"99,21 %","99,87 %",205
2024-04-08 00:00:00,,42,5,126.2,7.66,63.2,22.7,211,,35,1.335,0.26,"99,37 %","99,88 %",211
2024-04-09 00:00:00,1899-12-30 07:03:00,43,7,,7.19,,23.8,255,,35,1.5,0.35,"99,41 %","99,86 %",255
2024-04-10 00:00:00,1899-12-30 07:10:00,44,7,91.9,7.91,65.55,27.1,269,,35,1.71,0.27,"99,36 %","99,90 %",269
2024-04-11 00:00:00,,44,7,92,7.65,62.63,21.2,242,8151,35,1.58,0.216,"99,35 %","99,91 %",242
2024-04-12 00:00:00,1899-12-30 07:30:00,40,7,92.1,7.43,62.17,21.9,237,,35,1.53,0.201,"99,35 %","99,92 %",237
2024-04-15 00:00:00,,40,7,92.2,7.68,61.6,23.4,267,,35,2.645,0.422,"99,01 %","99,84 %",267
2024-04-16 00:00:00,1899-12-30 07:10:00,44,7,92.3,7.27,61.16,22.5,30,8083,55,1.6099999999999999,0.286,"94,63 %","99,05 %",30
2024-04-17 00:00:00,,40,7,92.4,7.25,,22.3,253,,55,2,0.28,"99,21 %","99,89 %",253
2024-04-18 00:00:00,1899-12-30 06:25:00,40,7,92.5,7.31,59.02,22,225,8042,40,1.57,0.22,"99,30 %","99,90 %",225
2024-04-19 00:00:00,1899-12-30 06:35:00,40,7,92.6,7.32,,22.5,227,8055,40,1.7,0.269,"99,25 %","99,88 %",227
2024-04-20 00:00:00,1899-12-30 08:30:00,36,7,92.7,7.2,55.69,23.5,248,,40,1.615,0.276,"99,35 %","99,89 %",248
2024-04-22 00:00:00,1899-12-30 07:00:00,38,7,92.8,7.27,56.79,24,230,8154,38,1.655,0.231,"99,28 %","99,90 %",230
2024-04-23 00:00:00,1899-12-30 06:40:00,40,7,92.9,7.28,57.98,24,260,8163,38,1.69,0.356,"99,35 %","99,86 %",260
2024-04-24 00:00:00,,38,7,93,7.24,58.64,22.8,251,8188,38,1.8,0.256,"99,28 %","99,90 %",251
2024-04-25 00:00:00,,40,7,93.1,7.5,60.71,20.8,213,8104,38,1.5,0.179,"99,30 %","99,92 %",213
2024-04-26 00:00:00,,36,7,93.2,7.47,56,22.7,200,8109,38,1.3900000000000001,0.27,"99,31 %","99,87 %",200
2024-04-29 00:00:00,,36,7,93.3,7.52,51.23,20.8,165,,,1.32,0.171,"99,20 %","99,90 %",165
2024-04-30 00:00:00,1899-12-30 06:40:00,36,7,93.4,7.28,51.2,22,190,,38,1.3250000000000002,0.291,"99,30 %","99,85 %",190
2024-05-01 00:00:00,1899-12-30 08:00:00,36,7,93.5,7.3,52.52,22,195,,38,1.3050000000000002,0.26,"99,33 %","99,87 %",195
2024-05-02 00:00:00,,40,7,93.6,7.58,45.96,19.2,179,,38,1.3,0.137,"99,27 %","99,92 %",179
2024-05-03 00:00:00,,32,7,93.7,7.52,47.57,19.1,153,6630,38,1.265,0.194,"99,17 %","99,87 %",153
2024-05-07 00:00:00,1899-12-30 06:30:00,32,7,93.8,7.27,43.18,21.2,135,8200,34,1.495,0.24,"98,89 %","99,82 %",135
2024-05-08 00:00:00,1899-12-30 06:45:00,30,7,93.9,7.25,44.15,20.6,125,,34,1.4300000000000002,0.23,"98,86 %","99,82 %",125
2024-05-09 00:00:00,1899-12-30 06:40:00,32,7,94,7.3,45.29,17.9,135,8000,32,1.5150000000000001,0.4,"98,88 %","99,70 %",135
2024-05-10 00:00:00,1899-12-30 07:30:00,30,7,94.1,7.29,43.26,19.4,120,8000,32,1.46,0.25,"98,78 %","99,79 %",120
2024-05-11 00:00:00,1899-12-30 08:10:00,30,,,7.3,41.61,18.6,119,8000,32,1.5550000000000002,0.19,"98,69 %","99,84 %",119
2024-05-12 00:00:00,1899-12-30 08:10:00,30,,,7.2,43,18.9,109,7960,30,1.47,0.201,"98,65 %","99,82 %",109
2024-05-13 00:00:00,1899-12-30 07:30:00,32,7,94.2,7.19,42.06,17.4,98.5,7900,28,1.52,0.21,"98,46 %","99,79 %",98.5
2024-05-14 00:00:00,1899-12-30 07:30:00,28,7,94.3,7.53,40.01,17.4,97.3,7893,28,1.54,0.256,"98,42 %","99,74 %",97.3
2024-05-16 00:00:00,,28,7,94.4,7.68,,17.6,90.1,8100,28,1.62,0.33,"98,20 %","99,63 %",90.1
2024-05-17 00:00:00,1899-12-30 07:15:00,28,5,87.28,7.66,43.7,17.2,82,,28,2.135,1.4,"97,40 %","98,29 %",82
2024-05-20 00:00:00,1899-12-30 09:00:00,34,5,89.11,7.3,44.53,16.5,88.3,,28,5.36,0.382,"93,93 %","99,57 %",88.3
2024-05-21 00:00:00,1899-12-30 09:00:00,30,8,89.6,7.68,44.79,17.4,93,8000,28,2.08,0.38,"97,76 %","99,59 %",93
2024-05-22 00:00:00,1899-12-30 07:30:00,30,7,87.68,7.5,43.9,17.7,89.6,7898,30,1.78,0.37,"98,01 %","99,59 %",89.6
2024-05-23 00:00:00,1899-12-30 07:40:00,30,7,90.38,7.27,45.18,17,86,8016,30,1.83,0.3,"97,87 %","99,65 %",86
2024-05-24 00:00:00,1899-12-30 07:15:00,30,9,87.47,7.36,43.73,15.6,83.1,7978,32,1.815,0.38,"97,82 %","99,54 %",83.1
2024-05-25 00:00:00,,,9,87.67,7.39,43.59,15,81,,32,1.71,0.397,"97,89 %","99,51 %",81
2024-05-27 00:00:00,1899-12-30 07:20:00,30,13,91.96,7.67,45.34,14.5,87.9,8000,32,1.7850000000000001,0.309,"97,97 %","99,65 %",87.9
2024-05-28 00:00:00,1899-12-30 07:20:00,30,13,93.29,7.57,46.64,14.1,89.2,8400,32,2.02,0.548,"97,74 %","99,39 %",89.2
2024-05-29 00:00:00,1899-12-30 07:20:00,30,6,93.32,7.6,46.64,15,92.2,8100,32,1.84,0.426,"98,00 %","99,54 %",92.2
2024-05-30 00:00:00,1899-12-30 07:40:00,30,7,78.45,7.66,38.98,14.8,88.6,8100,32,2.02,0.247,"97,72 %","99,72 %",88.6
2024-05-31 00:00:00,1899-12-30 06:25:00,30,7,,7.35,,15.4,84.2,8120,,2.51,0.3,"97,02 %","99,64 %",84.2
2024-06-03 00:00:00,1899-12-30 08:00:00,26,5,83.56,7.3,41.47,14.4,68.5,7844,32,2.7750000000000004,0.549,"95,95 %","99,20 %",68.5
2024-06-04 00:00:00,1899-12-30 06:50:00,30,5,85.93,7.36,42.96,15.1,72.7,,30,2.87,0.54,"96,05 %","99,26 %",72.7
2024-06-05 00:00:00,1899-12-30 06:30:00,32,10,87.4,7.42,43.66,16.8,74,7788,30,2.175,0.537,"97,06 %","99,27 %",74
2024-06-06 00:00:00,1899-12-30 07:00:00,30,13,90.31,7.12,45.16,17.3,71.5,7783,30,2.715,0.629,"96,20 %","99,12 %",71.5
2024-06-07 00:00:00,1899-12-30 08:30:00,36,3,87.17,7.38,43.56,18.7,66.7,5057,30,2.04,,"96,94 %",,66.7
2024-06-08 00:00:00,1899-12-30 09:00:00,32,9,87.11,7.29,43.57,18.8,67,7850,32,2.715,0.712,"95,95 %","98,94 %",67
2024-06-10 00:00:00,1899-12-30 07:30:00,30,7,81.78,7.38,40.7,19.5,59,7890,28,2.38,1.02,"95,97 %","98,27 %",59
2024-06-11 00:00:00,1899-12-30 07:00:00,30,9,92.38,7.44,45.98,19.5,57.1,,28,2.125,0.424,"96,28 %","99,26 %",57.1
2024-06-12 00:00:00,1899-12-30 07:30:00,30,5,87.81,7.49,43.77,20.8,55.9,7800,28,2.22,0.416,"96,03 %","99,26 %",55.9
2024-06-13 00:00:00,1899-12-30 07:05:00,30,5,87.15,7.5,43.53,22.1,60.1,7710,28,1.71,0.257,"97,15 %","99,57 %",60.1
2024-06-14 00:00:00,1899-12-30 07:00:00,30,6,90.48,7.58,45.24,21.4,59.8,8100,28,2.03,0.3,"96,61 %","99,50 %",59.8
2024-06-18 00:00:00,1899-12-30 07:10:00,30,5,75.72,7.45,37.85,,57.6,7600,28,1.86,,"96,77 %",,57.6
2024-06-19 00:00:00,1899-12-30 07:25:00,30,11,94.32,7.1,47.26,19.5,54.6,7980,28,1.67,0.225,"96,94 %","99,59 %",54.6
2024-06-21 00:00:00,1899-12-30 09:00:00,30,8,95.78,7.27,47.89,26.9,52.7,,28,1.725,0.296,"96,73 %","99,44 %",52.7
2024-06-24 00:00:00,1899-12-30 08:00:00,30,11,485.7,7.23,242.8,18.4,55.2,7900,28,1.65,0.247,"97,01 %","99,55 %",55.2
2024-06-25 00:00:00,1899-12-30 06:55:00,30,8,497.8,7.62,248.9,16.6,49.2,7960,28,1.72,0.261,"96,50 %","99,47 %",49.2
2024-06-26 00:00:00,1899-12-30 07:10:00,32,9,501.3,6.81,250.6,14.2,53.6,,30,1.9249999999999998,0.26,"96,41 %","99,51 %",53.6
2024-06-27 00:00:00,1899-12-30 07:30:00,32,10,490.1,7.55,245.1,15.3,53.7,7899,36,1.83,0.356,"96,59 %","99,34 %",53.7
2024-06-28 00:00:00,1899-12-30 07:10:00,32,10,,7.58,,16.6,51.5,7868,24,2.64,0.7,"94,87 %","98,64 %",51.5
2024-07-01 00:00:00,1899-12-30 08:00:00,36,9,84.77,7.47,42.45,13.7,41.5,7699,20,2.05,0.346,"95,06 %","99,17 %",41.5
2024-07-02 00:00:00,1899-12-30 06:30:00,30,8,48.88,7.55,244.4,14.7,42,,24,2.255,0.419,"94,63 %","99,00 %",42
2024-07-03 00:00:00,1899-12-30 07:15:00,32,9,67.74,7.59,33.89,15.5,40.1,,24,2.32,0.39,"94,21 %","99,03 %",40.1
2024-07-04 00:00:00,1899-12-30 07:20:00,30,7,61.04,7.6,30.53,14.3,38.5,7920,24,2.2,0.437,"94,29 %","98,86 %",38.5
2024-07-05 00:00:00,1899-12-30 07:20:00,30,5,63.18,7.6,31.59,14.5,37.6,8200,24,,0.756,,"97,99 %",37.6
2024-07-07 00:00:00,1899-12-30 08:25:00,30,6,62.39,7.52,31.2,13.4,35.1,,20,2.165,0.399,"93,83 %","98,86 %",35.1
2024-07-08 00:00:00,1899-12-30 07:30:00,30,5,63.74,7.44,31.87,13.1,38.6,7870,20,2.32,0.558,"93,99 %","98,55 %",38.6
2024-07-10 00:00:00,1899-12-30 07:10:00,32,5,69.11,7.63,34.55,11.8,39.5,7982,20,2.5,0.501,"93,67 %","98,73 %",39.5
2024-07-11 00:00:00,1899-12-30 07:15:00,32,5,89.11,7.62,44.55,10.9,45.6,7952,24,,0.63,,"98,62 %",45.6
2024-07-12 00:00:00,1899-12-30 07:15:00,32,5,68.26,7.25,34.13,10.5,40.1,7969,22,,0.52,,"98,70 %",40.1
2024-07-15 00:00:00,1899-12-30 08:00:00,36,9,71.04,7.28,35.52,13.5,33.5,7770,24,2.0949999999999998,0.601,"93,75 %","98,21 %",33.5
2024-07-16 00:00:00,1899-12-30 07:40:00,32,5,73.13,7.55,36.56,14.1,36.6,7820,24,2.16,0.627,"94,10 %","98,29 %",36.6
2024-07-17 00:00:00,1899-12-30 07:35:00,32,5,73.12,7.58,36.55,13.9,35.9,8080,20,2.26,0.676,"93,70 %","98,12 %",35.9
2024-07-18 00:00:00,1899-12-30 07:40:00,32,6,75.86,7.59,37.98,14.6,35.2,,24,2.02,0.583,"94,26 %","98,34 %",35.2
2024-07-19 00:00:00,1899-12-30 07:40:00,32,6,67.5,7.59,33.8,19.2,33.5,7913,24,2.17,0.756,"93,52 %","97,74 %",33.5
2024-07-22 00:00:00,1899-12-30 07:40:00,30,5,61.9,7.59,30.95,15.4,33.2,7800,24,2.4,1.02,"92,77 %","96,93 %",33.2
2024-07-23 00:00:00,1899-12-30 07:40:00,30,5,60,7.53,30,15.8,31.2,,24,2.115,0.643,"93,22 %","97,94 %",31.2
2024-07-24 00:00:00,1899-12-30 07:15:00,28,5,59.9,7.64,29.96,17,30.1,7950,16,2.065,0.491,"93,14 %","98,37 %",30.1
2024-07-25 00:00:00,1899-12-30 07:10:00,28,5,57.52,7.55,28.77,15.3,27.7,7900,18,1.97,0.357,"92,89 %","98,71 %",27.7
2024-07-26 00:00:00,1899-12-30 07:15:00,28,5,58.4,7.66,29.28,16.3,26.2,8000,18,1.8900000000000001,0.401,"92,79 %","98,47 %",26.2
2024-07-29 00:00:00,1899-12-30 08:00:00,30,7,63.68,7.57,31.84,16.4,22.3,7890,18,1.865,0.405,"91,64 %","98,18 %",22.3
2024-07-30 00:00:00,1899-12-30 07:05:00,30,6,65.32,7.61,33.65,14,25.6,7885,18,1.94,0.392,"92,42 %","98,47 %",25.6
2024-07-31 00:00:00,1899-12-30 07:40:00,30,6,64.47,7.66,32.42,16,25.6,6000,18,1.705,0.36,"93,34 %","98,59 %",25.6
2024-08-01 00:00:00,1899-12-30 07:20:00,30,5,67.87,7.64,33.94,17.4,25.2,8200,18,1.9649999999999999,0.461,"92,20 %","98,17 %",25.2
2024-08-02 00:00:00,1899-12-30 07:20:00,30,5,65.81,7.63,32.91,19.2,30,8151,18,1.87,0.496,"93,77 %","98,35 %",30
2024-08-03 00:00:00,1899-12-30 09:30:00,30,5,65.9,7.64,33.03,,35,8022,18,1.8250000000000002,0.472,"94,79 %","98,65 %",35
2024-08-05 00:00:00,1899-12-30 08:20:00,30,6,66.42,7.61,33.2,17.6,39.5,8052,18,1.815,0.589,"95,41 %","98,51 %",39.5
2024-08-06 00:00:00,1899-12-30 07:15:00,32,5,69.74,7.34,34.86,18.7,41.8,8060,20,1.845,0.386,"95,59 %","99,08 %",41.8
2024-08-07 00:00:00,1899-12-30 07:15:00,32,5,71.76,7.62,35.85,16.7,47.5,8080,22,1.88,0.401,"96,04 %","99,16 %",47.5
2024-08-08 00:00:00,1899-12-30 07:15:00,30,5,69.64,7.66,34.9,15.3,71.4,8000,20,2.05,0.465,"97,13 %","99,35 %",71.4
2024-08-09 00:00:00,1899-12-30 07:20:00,30,5,65.69,7.68,32.84,13,58.3,7970,20,2.3200000000000003,0.435,"96,02 %","99,25 %",58.3
2024-08-12 00:00:00,,34,9,65.51,7.39,32.75,15,25.4,,,2.26,0.554,"91,10 %","97,82 %",25.4
2024-08-13 00:00:00,1899-12-30 07:25:00,32,6,69.38,7.63,34.69,14.7,33.7,8150,30,2.24,0.623,"93,35 %","98,15 %",33.7
2024-08-15 00:00:00,1899-12-30 07:20:00,30,6,70.06,7.27,35.54,15.3,32.3,8255,20,2.43,0.646,"92,48 %","98,00 %",32.3
2024-08-16 00:00:00,,28,7,67.8,7.66,33.91,16.3,27.9,,20,2.4,0.674,"91,40 %","97,58 %",27.9
2024-08-19 00:00:00,1899-12-30 07:20:00,30,5,70.39,7.64,35.19,16.9,26.1,8070,20,2.225,0.631,"91,48 %","97,58 %",26.1
2024-08-20 00:00:00,1899-12-30 07:25:00,30,5,70.39,7.6,35.19,16,25.8,8067,18,2.02,0.629,"92,17 %","97,56 %",25.8
2024-08-22 00:00:00,1899-12-30 07:25:00,30,5,73.09,7.71,36.62,15.3,28,8080,18,2.01,0.6,"92,82 %","97,86 %",28
2024-08-23 00:00:00,1899-12-30 07:25:00,30,7,70.47,7.7,35.22,13.8,28.5,8058,,2.165,0.699,"92,40 %","97,55 %",28.5
2024-08-26 00:00:00,,34,5,70.3,7.28,35.37,13.9,26.7,8030,17,2.13,0.487,"92,02 %","98,18 %",26.7
2024-08-27 00:00:00,1899-12-30 07:25:00,28,5,71.44,7.63,35.73,14.5,30.5,8079,,2.175,0.56,"92,87 %","98,16 %",30.5
2024-08-29 00:00:00,1899-12-30 07:20:00,28,5,74.71,7.65,37.36,15.9,32.2,7172,20,2.1950000000000003,0.625,"93,18 %","98,06 %",32.2
2024-08-31 00:00:00,1899-12-30 08:20:00,28,9,,7.65,,15.4,31,,20,2.165,0.691,"93,02 %","97,77 %",31
2024-09-02 00:00:00,1899-12-30 07:30:00,28,8,70.91,7.63,35.45,15.4,28.6,8110,20,2.12,0.683,"92,59 %","97,61 %",28.6
2024-09-04 00:00:00,1899-12-30 07:20:00,28,9,74.25,7.63,37.11,16.3,24.7,7510,20,1.85,0.587,"92,51 %","97,62 %",24.7
2024-09-05 00:00:00,1899-12-30 07:25:00,28,9,,7.68,,15.9,27.5,8132,16,2.22,0.46,"91,93 %","98,33 %",27.5
2024-09-06 00:00:00,1899-12-30 07:05:00,28,9,75.39,7.65,37.69,16.4,24.1,8110,20,1.93,0.563,"91,99 %","97,66 %",24.1
2024-09-09 00:00:00,,30,,72.02,7.55,36.03,16.1,20.7,7560,20,1.585,0.593,"92,34 %","97,14 %",20.7
2024-09-10 00:00:00,1899-12-30 07:35:00,30,9,74.5,7.67,37.26,18.6,21.6,8132,20,1.61,0.5,"92,55 %","97,69 %",21.6
2024-09-11 00:00:00,1899-12-30 07:20:00,30,9,76.7,7.73,38.35,19.8,25.9,,20,1.73,0.416,"93,32 %","98,39 %",25.9
2024-09-12 00:00:00,1899-12-30 08:30:00,30,9,72.29,7.67,36.24,19.2,27.1,8130,20,1.8,0.491,"93,36 %","98,19 %",27.1
2024-09-13 00:00:00,,30,9,75.31,7.62,37.36,18.2,27,,20,1.81,0.49,"93,30 %","98,19 %",27
2024-09-16 00:00:00,1899-12-30 07:30:00,30,7,68.19,7.64,34.1,17.7,24.6,8242,20,2.02,0.646,"91,79 %","97,37 %",24.6
2024-09-17 00:00:00,1899-12-30 07:30:00,30,8,70.33,7.66,35.17,18.7,23.9,8261,20,1.84,0.739,"92,30 %","96,91 %",23.9
2024-09-18 00:00:00,1899-12-30 07:30:00,28,9,72.49,7.62,36.25,20.3,24.2,8300,20,1.66,0.542,"93,14 %","97,76 %",24.2
2024-09-19 00:00:00,1899-12-30 07:30:00,30,11,73.36,7.66,36.88,21.6,24.2,8300,20,1.615,0.427,"93,33 %","98,24 %",24.2
2024-09-20 00:00:00,1899-12-30 07:30:00,30,11,72.13,7.61,36.67,21.2,24,8316,20,1.54,0.41,"93,58 %","98,29 %",24
2024-09-23 00:00:00,,30,9,69.67,7.56,34.84,20.6,20.6,8029,20,1.36,0.51,"93,40 %","97,52 %",20.6
2024-09-24 00:00:00,1899-12-30 07:30:00,30,9,69.25,7.62,34.74,21.2,22,8042,20,1.5499999999999998,0.388,"92,95 %","98,24 %",22
2024-09-25 00:00:00,1899-12-30 07:10:00,30,7,74.79,7.71,37.4,21,22.1,8040,20,,0.327,,"98,52 %",22.1
2024-09-26 00:00:00,1899-12-30 07:20:00,30,7,76.62,7.69,38.32,20.8,24.3,8059,20,1.3,0.331,"94,65 %","98,64 %",24.3
2024-09-27 00:00:00,1899-12-30 07:20:00,30,9,74.61,7.7,37.31,19.5,25,8052,20,1.3900000000000001,0.507,"94,44 %","97,97 %",25
2024-09-30 00:00:00,1899-12-30 07:20:00,30,9,71.74,7.7,35.87,22.7,23.1,8047,20,1.39,0.401,"93,98 %","98,26 %",23.1
2024-10-01 00:00:00,1899-12-30 07:30:00,30,9,74.17,7.74,37.09,23.8,21.9,8032,20,1.335,0.378,"93,90 %","98,27 %",21.9
2024-10-02 00:00:00,1899-12-30 07:10:00,30,11,77.14,7.78,39.57,21.8,25,8051,20,1.43,0.307,"94,28 %","98,77 %",25
2024-10-03 00:00:00,1899-12-30 07:20:00,30,11,77.11,7.76,38.65,20.1,27.1,8064,20,1.42,0.341,"94,76 %","98,74 %",27.1
2024-10-04 00:00:00,1899-12-30 07:05:00,28,11,74.25,7.72,37.47,19.9,31.7,8072,20,1.525,0.432,"95,19 %","98,64 %",31.7
2024-10-08 00:00:00,1899-12-30 06:55:00,30,11,70.72,7.67,35.36,21.2,26.8,8134,20,1.645,0.447,"93,86 %","98,33 %",26.8
2024-10-10 00:00:00,1899-12-30 06:50:00,30,12,66.89,7.71,33.35,20.6,28,7950,20,1.67,0.456,"94,04 %","98,37 %",28
2024-10-15 00:00:00,1899-12-30 07:00:00,28,9,71.68,7.71,35.84,22.9,23.4,,20,1.39,0.431,"94,06 %","98,16 %",23.4
2024-10-17 00:00:00,1899-12-30 07:25:00,30,11,75.8,7.75,37.9,23,24.5,8075,20,1.255,0.35,"94,88 %","98,57 %",24.5
2024-10-18 00:00:00,1899-12-30 07:25:00,30,11,69.46,7.65,34.74,22.5,23.9,8067,20,1.3599999999999999,0.47,"94,31 %","98,03 %",23.9
2024-10-21 00:00:00,,36,11,71.2,7.18,35.6,25.3,22.3,,20,1.285,0.373,"94,24 %","98,33 %",22.3
2024-10-22 00:00:00,1899-12-30 07:10:00,28,11,74.43,7.75,37.19,26.3,23.2,8120,20,1.13,0.431,"95,13 %","98,14 %",23.2
2024-10-23 00:00:00,1899-12-30 07:20:00,30,9,80.27,7.59,40.14,26.4,20.7,,20,1.07,0.456,"94,83 %","97,80 %",20.7
2024-10-24 00:00:00,1899-12-30 07:05:00,28,9,81.07,7.77,46.55,25.2,29.2,8160,20,1.045,0.52,"96,42 %","98,22 %",29.2
2024-10-25 00:00:00,1899-12-30 06:50:00,30,9,79.28,7.76,39.63,24,28.1,8152,20,1.1,,"96,09 %",,28.1
2024-10-28 00:00:00,1899-12-30 06:50:00,28,12,81.33,7.7,40.67,23.2,35.4,8134,20,1.29,0.269,"96,36 %","99,24 %",35.4
2024-10-29 00:00:00,1899-12-30 06:50:00,28,12,79.95,7.7,39.97,24.4,34.8,8125,20,1.35,0.296,"96,12 %","99,15 %",34.8
2024-10-30 00:00:00,1899-12-30 06:50:00,30,13,81.18,7.69,40.59,24.2,31.8,8118,20,1.27,0.24,"96,01 %","99,25 %",31.8
2024-10-31 00:00:00,,30,13,74.14,7.64,37.08,24.2,31.4,,20,1.48,0.313,"95,29 %","99,00 %",31.4
2024-11-01 00:00:00,1899-12-30 07:15:00,30,12,70.98,7.68,35.49,25.6,30.1,8126,20,1.36,0.276,"95,48 %","99,08 %",30.1
2024-11-04 00:00:00,,30,13,73.88,7.33,36.95,25.6,24.5,,,1.11,0.309,"95,47 %","98,74 %",24.5
2024-11-05 00:00:00,1899-12-30 07:30:00,30,11,74.28,7.71,37.13,24.4,31.8,8276,20,1.1400000000000001,0.361,"96,42 %","98,86 %",31.8
2024-11-06 00:00:00,1899-12-30 07:20:00,30,12,75.8,7.69,37.89,24.3,26.9,8260,20,1.09,0.351,"95,95 %","98,70 %",26.9
2024-11-07 00:00:00,1899-12-30 07:10:00,30,9,69.84,7.82,34.98,25.4,26.5,,20,1.1549999999999998,0.31,"95,64 %","98,83 %",26.5
2024-11-11 00:00:00,1899-12-30 07:45:00,30,9,70.99,7.76,35.5,24.5,26.6,8259,20,1.3599999999999999,0.313,"94,89 %","98,82 %",26.6
2024-11-12 00:00:00,1899-12-30 07:15:00,34,9,77.85,7.74,38.93,23.1,32.7,8270,20,1.295,0.307,"96,04 %","99,06 %",32.7
2024-11-13 00:00:00,1899-12-30 07:15:00,30,13,82.36,7.73,41.19,23.5,36.8,8290,20,1.32,0.296,"96,41 %","99,20 %",36.8
2024-11-14 00:00:00,1899-12-30 07:00:00,30,12,78.67,7.65,39.41,24,31.8,8316,20,1.33,0.29,"95,82 %","99,09 %",31.8
2024-11-15 00:00:00,1899-12-30 07:15:00,30,12,73.43,7.73,36.81,25,30.1,8305,18,1.27,0.28,"95,78 %","99,07 %",30.1
2024-11-19 00:00:00,1899-12-30 07:15:00,30,11,77.87,7.63,38.94,24.4,26.3,8358,18,1.14,0.271,"95,67 %","98,97 %",26.3
2024-11-21 00:00:00,1899-12-30 07:10:00,32,10,78.05,7.67,39.02,23.4,31.4,8412,18,1.18,0.286,"96,24 %","99,09 %",31.4
2024-11-22 00:00:00,1899-12-30 06:55:00,30,11,77.12,7.71,38.57,24.1,29.1,8436,18,1.35,0.269,"95,36 %","99,08 %",29.1
2024-11-25 00:00:00,1899-12-30 07:30:00,34,13,86.93,7.74,43.47,25.7,49.3,8440,18,1.47,0.248,"97,02 %","99,50 %",49.3
2024-11-26 00:00:00,1899-12-30 07:15:00,40,13,97.04,7.82,48.53,25.3,96.5,8430,18,1.995,0.278,"97,93 %","99,71 %",96.5
2024-11-27 00:00:00,1899-12-30 07:20:00,38,13,87.36,7.84,43.67,25.2,135,8479,21,2.4450000000000003,0.421,"98,19 %","99,69 %",135
2024-11-28 00:00:00,1899-12-30 07:12:00,34,11,84.04,7.64,42.1,24.2,118,8505,25,1.6099999999999999,,"98,64 %",,118
2024-11-29 00:00:00,1899-12-30 07:15:00,34,11,82.55,7.7,41.29,26.2,104,8522,25,2.36,0.27,"97,73 %","99,74 %",104
2024-12-03 00:00:00,1899-12-30 07:25:00,34,11,73.21,7.69,36.6,23.9,679,,23,1.48,0.201,"99,78 %","99,97 %",679
2024-12-04 00:00:00,1899-12-30 07:30:00,32,11,69.85,7.69,34.92,25.4,72.6,8552,22,1.57,0.232,"97,84 %","99,68 %",72.6
2024-12-09 00:00:00,1899-12-30 07:30:00,32,12,2.08,7.64,36.04,24,103.5,8400,24,1.17,0.2,"98,87 %","99,81 %",103.5
2024-12-10 00:00:00,1899-12-30 07:45:00,34,12,71.77,7.68,35.89,24.7,113,8479,24,1.345,0.2,"98,81 %","99,82 %",113
2024-12-12 00:00:00,1899-12-30 07:30:00,32,12,65.46,7.74,32.6,25.6,92.5,8506,24,1.4300000000000002,0.221,"98,45 %","99,76 %",92.5
2024-12-16 00:00:00,,40,7,57.14,7.4,28.58,24.8,62.5,,,1.54,0.453,"97,54 %","99,28 %",62.5
2024-12-17 00:00:00,1899-12-30 07:20:00,32,,57.26,7.62,25.58,26,79.9,8572,23,1.38,0.339,"98,27 %","99,58 %",79.9
2024-12-18 00:00:00,1899-12-30 07:10:00,30,,56.39,7.65,28.19,25.4,84.9,8599,23,1.43,0.271,"98,32 %","99,68 %",84.9
2024-12-19 00:00:00,,32,,55.66,7.69,27.83,24.9,80.4,8662,22,1.5699999999999998,0.28,"98,05 %","99,65 %",80.4
2024-12-20 00:00:00,,32,5,55.24,7.32,27.31,25.8,70.7,8650,22,1.65,0.211,"97,67 %","99,70 %",70.7
2025-01-02 00:00:00,,38,7,66.52,7.32,33.31,26.1,63.3,,,1.57,0.158,"97,52 %","99,75 %",63.3
2025-01-03 00:00:00,1899-12-30 06:35:00,32,7,61.77,760,30.87,26.1,64.4,,22,1.625,0.265,"97,48 %","99,59 %",64.4
2025-01-06 00:00:00,1899-12-30 07:15:00,30,7,32.31,7.66,31.3,26.9,57.4,,27,1.21,0.241,"97,89 %","99,58 %",57.4
2025-01-07 00:00:00,1899-12-30 07:15:00,30,7,,7.42,,26.9,61.7,,,1.11,0.252,"98,20 %","99,59 %",61.7
2025-01-09 00:00:00,1899-12-30 07:30:00,34,8,65.69,7.68,32.71,27.5,67.2,,26.9,1.15,0.261,"98,29 %","99,61 %",67.2
2025-01-10 00:00:00,1899-12-30 07:00:00,36,8,69.26,7.7,34.66,27.5,94.7,,,1.1400000000000001,0.246,"98,80 %","99,74 %",94.7
2025-01-13 00:00:00,,44,5,73.02,7.44,36.51,26.5,119,8522,26.6,1.11,0.361,"99,07 %","99,70 %",119
2025-01-14 00:00:00,1899-12-30 07:30:00,40,11,73.09,7.77,36.54,27.8,140,,26.6,1.31,0.256,"99,06 %","99,82 %",140
2025-01-15 00:00:00,1899-12-30 07:15:00,40,11,74.26,7.8,37.13,28.3,142,8470,27,1.51,0.18,"98,94 %","99,87 %",142
2025-01-16 00:00:00,1899-12-30 07:15:00,40,11,70.1,7.7,35.18,28.3,138,8532,27,2.59,0.45,"98,12 %","99,67 %",138
2025-01-17 00:00:00,1899-12-30 07:05:00,36,10,68.73,7.8,34.48,,117,8512,,1.32,0.282,"98,87 %","99,76 %",117
2025-01-20 00:00:00,,32,9,68.95,7.84,34.54,38,116,,,1.45,0.243,"98,75 %","99,79 %",116
2025-01-21 00:00:00,,38,9,70.51,7.45,35.28,26.6,119,,,1.545,0.206,"98,70 %","99,83 %",119
2025-01-22 00:00:00,1899-12-30 07:30:00,36,9,71.35,7.81,35.62,29.3,139,,28,1.605,0.425,"98,85 %","99,69 %",139
2025-01-23 00:00:00,1899-12-30 07:15:00,36,9,70.31,7.77,35.15,28,132,,29,1.63,0.25,"98,77 %","99,81 %",132
2025-01-24 00:00:00,1899-12-30 07:30:00,34,9,67.45,7.81,33.74,27.9,127,,29,1.96,0.25,"98,46 %","99,80 %",127
2025-01-27 00:00:00,,50,13,66.44,7.41,33.22,26.6,129,,,1.15,0.394,"99,11 %","99,69 %",129
2025-01-28 00:00:00,1899-12-30 07:45:00,34,11,70.03,7.89,35.01,28.3,170,8700,30,2.005,0.295,"98,82 %","99,83 %",170
2025-01-29 00:00:00,1899-12-30 07:20:00,36,11,72.15,7.9,36.07,27.3,210,8750,28,1.69,0.293,"99,20 %","99,86 %",210
2025-01-30 00:00:00,1899-12-30 07:30:00,36,12,,7.86,,27.7,170,8750,,1.7,0.25,"99,00 %","99,85 %",170
2025-02-04 00:00:00,1899-12-30 07:25:00,34,7,65.89,7.9,32.84,29.9,156,,27,1.6099999999999999,0.222,"98,97 %","99,86 %",156
2025-02-05 00:00:00,1899-12-30 07:20:00,34,7,64.56,7.6,32.37,28.7,140,,27,1.74,0.21,"98,76 %","99,85 %",140
2025-02-07 00:00:00,1899-12-30 07:15:00,34,7,64.28,7.94,32.13,28.6,135,,27,2.2,0.353,"98,37 %","99,74 %",135
2025-02-10 00:00:00,,60,13,68.08,7.46,34.05,29.3,123,,24,1.2349999999999999,0.215,"99,00 %","99,83 %",123
2025-02-11 00:00:00,1899-12-30 07:50:00,34,7,69.1,7.92,34.55,,166,8500,24,1.4649999999999999,0.3,"99,12 %","99,82 %",166
2025-02-13 00:00:00,1899-12-30 07:30:00,34,7,65.59,7.97,32.74,27.6,136,8500,24,1.5,0.419,"98,90 %","99,69 %",136
2025-02-14 00:00:00,1899-12-30 07:40:00,36,7,67.86,7.97,33.92,28.2,142,8471,24,1.725,0.32,"98,79 %","99,77 %",142
2025-02-17 00:00:00,1899-12-30 07:50:00,36,9,69.25,7.99,34.76,27.4,165,8462,26,3.625,0.394,"97,80 %","99,76 %",165
2025-02-18 00:00:00,1899-12-30 07:50:00,38,9,72.49,8.03,36.25,26.2,185,8444,26,1.4,0.2,"99,24 %","99,89 %",185
2025-02-19 00:00:00,1899-12-30 07:30:00,36,9,73.59,8.05,36.8,26.1,193,8475,26,1.3,0.19,"99,33 %","99,90 %",193
2025-02-21 00:00:00,1899-12-30 07:35:00,36,9,70.73,7.9,35.37,28.6,169,8456,28,1.4249999999999998,0.226,"99,16 %","99,87 %",169
2025-02-24 00:00:00,,40,5,70.53,7.58,35.26,28.7,125,8425,26,1.03,0.194,"99,18 %","99,84 %",125
2025-02-25 00:00:00,1899-12-30 07:35:00,38,7,71.15,7.99,35.57,29,150,,26,1.53,0.252,"98,98 %","99,83 %",150
2025-02-26 00:00:00,1899-12-30 07:25:00,36,6,69.94,7.96,34.97,27.8,145,,28,1.32,0.236,"99,09 %","99,84 %",145
2025-02-27 00:00:00,,38,,81.1,7.97,40.55,27.2,128,,26,2.1,0.23,"98,36 %","99,82 %",128
2025-02-28 00:00:00,,36,7,74.42,7.55,37.2,27.5,115,,26,1.29,0.248,"98,88 %","99,78 %",115
2025-03-05 00:00:00,,36,7,70.65,7.35,35.33,28.5,116,,26,1.17,0.245,"98,99 %","99,79 %",116
2025-03-06 00:00:00,,36,7,69.52,7.49,34.74,29.2,101,,26,1.15,0.173,"98,86 %","99,83 %",101
2025-03-07 00:00:00,,44,11,68.57,7.58,34.34,30.4,137,,26,1.33,0.424,"99,03 %","99,69 %",137
2025-03-10 00:00:00,,44,15,75.63,7.59,37.81,24.6,171,,26,1.46,0.195,"99,15 %","99,89 %",171
2025-03-11 00:00:00,1899-12-30 04:48:00,40,13,82.82,7.62,41.32,25.6,224,,,1.26,0.258,"99,44 %","99,88 %",224
2025-03-12 00:00:00,1899-12-30 08:00:00,44,11,82.52,7.78,41.26,23.5,330,,,1.5750000000000002,,"99,52 %",,330
2025-03-13 00:00:00,,36,9,81.52,7.66,40.76,22,332,,,1.3,0.302,"99,61 %","99,91 %",332
2025-03-14 00:00:00,1899-12-30 11:30:00,42,5,76.09,7.67,38.53,22.4,235,,,1.83,0.407,"99,22 %","99,83 %",235
2025-03-17 00:00:00,,40,8,77.67,7.64,38.83,24.4,157,,28,1.62,0.319,"98,97 %","99,80 %",157
2025-03-18 00:00:00,,44,9,74.4,7.58,37.46,23.6,168,,,1.355,0.151,"99,19 %","99,91 %",168
2025-03-19 00:00:00,1899-12-30 06:45:00,42,9,81.72,7.96,40.85,24.9,210,8207,28,1.49,0.212,"99,29 %","99,90 %",210
2025-03-20 00:00:00,1899-12-30 07:15:00,42,9,83.31,8.06,41.69,25.5,205,8205,30,1.505,0.296,"99,27 %","99,86 %",205
2025-03-21 00:00:00,1899-12-30 07:15:00,42,10,77.93,8.03,38.97,25.1,188,8210,30,1.47,0.21,"99,22 %","99,89 %",188
2025-03-26 00:00:00,1899-12-30 07:50:00,42,9,82.7,8.01,41.34,25.1,310,,,1.3399999999999999,0.247,"99,57 %","99,92 %",310
2025-03-27 00:00:00,1899-12-30 07:45:00,44,9,85.32,8.16,42.45,25.7,380,,32,1.35,0.17,"99,64 %","99,96 %",380
2025-03-28 00:00:00,1899-12-30 07:25:00,46,9,82.96,8.09,41.46,25.2,415,8327,34,1.74,0.19,"99,58 %","99,95 %",415
2025-03-30 00:00:00,1899-12-30 08:30:00,42,10,,8.1,,24.5,320,8345,34,1.8450000000000002,0.231,"99,42 %","99,93 %",320
2025-03-31 00:00:00,1899-12-30 07:30:00,44,10,76.61,8.11,38.31,23.3,315,8352,32,1.67,0.25,"99,47 %","99,92 %",315
2025-04-01 00:00:00,1899-12-30 07:30:00,46,10,80.24,8.17,40.11,22.5,330,,36,1.855,0.356,"99,44 %","99,89 %",330
2025-04-03 00:00:00,1899-12-30 07:30:00,46,10,86,8.13,42.99,22.8,340,,34,1.4649999999999999,0.315,"99,57 %","99,91 %",340
2025-04-04 00:00:00,1899-12-30 07:30:00,44,,83.73,8.18,41.86,20.7,307,,34,1.56,0.257,"99,49 %","99,92 %",307
2025-04-07 00:00:00,,42,9,81.81,7.66,46.91,20,187,,28,1.62,0.15,"99,13 %","99,92 %",187
2025-04-08 00:00:00,1899-12-30 07:30:00,46,9,83.71,7.99,41.69,20.6,220,8637,26,1.8849999999999998,0.356,"99,14 %","99,84 %",220
2025-04-09 00:00:00,1899-12-30 07:30:00,48,10,85.27,7.99,42.63,20.9,222,8650,32,1.845,0.299,"99,17 %","99,87 %",222
2025-04-11 00:00:00,1899-12-30 07:30:00,44,10,82.46,8.07,41.25,22.2,194,,,1.46,0.316,"99,25 %","99,84 %",194
2025-04-12 00:00:00,1899-12-30 08:30:00,44,10,,8.05,,22,175,8372,34,1.605,0.359,"99,08 %","99,79 %",175
2025-04-14 00:00:00,1899-12-30 07:30:00,42,8,82.18,8.06,41.09,20.9,155,8392,34,1.55,0.267,"99,00 %","99,83 %",155
2025-04-15 00:00:00,1899-12-30 07:30:00,44,7,83.06,8.17,41.53,21,178,8365,34,1.555,0.233,"99,13 %","99,87 %",178
2025-04-21 00:00:00,,46,17,86.78,7.63,43.4,19.2,159,8273,32,1.82,0.373,"98,86 %","99,77 %",159
2025-04-22 00:00:00,1899-12-30 07:10:00,46,7,88.99,8.13,44.51,19.3,200,,32,1.35,0.281,"99,33 %","99,86 %",200
2025-04-23 00:00:00,1899-12-30 07:10:00,48,7,91.73,8.11,45.9,21.1,212,8397,32,1.48,0.269,"99,30 %","99,87 %",212
2025-04-24 00:00:00,1899-12-30 07:10:00,48,8,,8.07,,21.2,205,8405,32,1.51,0.237,"99,26 %","99,88 %",205
2025-04-25 00:00:00,1899-12-30 07:10:00,48,7,84.65,8.1,42.32,22.2,187,8426,32,1.2650000000000001,0.254,"99,32 %","99,86 %",187
2025-04-26 00:00:00,1899-12-30 08:30:00,46,7,,8.1,,20.6,172,8461,32,1.4,0.269,"99,19 %","99,84 %",172
2025-04-28 00:00:00,1899-12-30 07:10:00,44,8,89.38,8.11,44.69,19.8,193,8452,32,1.35,0.3,"99,30 %","99,84 %",193
2025-04-29 00:00:00,1899-12-30 07:10:00,48,9,89.89,8.16,49.92,20.1,195,8410,32,1.35,0.325,"99,31 %","99,83 %",195
2025-04-30 00:00:00,1899-12-30 07:10:00,48,9,96.13,8.17,45.05,20.6,201,8437,32,1.26,0.31,"99,37 %","99,85 %",201
2025-05-05 00:00:00,,40,13,76.49,7.67,36.19,22,127,,36,1.495,0.717,"98,82 %","99,44 %",127
2025-05-06 00:00:00,1899-12-30 07:10:00,40,13,78.33,8.11,39.17,22.4,134,,36,1.4849999999999999,0.435,"98,89 %","99,68 %",134

"""

# ============================================================
#  CARGA Y LIMPIEZA DEL CSV EMBEBIDO
# ============================================================

@st.cache_data(show_spinner=False)
def load_embedded_csv():
    buffer = io.StringIO(CSV_DATA)
    df = pd.read_csv(buffer)

    # Normalizar nombres de columnas
    rename_map = {
        "Alc, (mg/l)": "alc",
        "Cloruros (mg/l)": "cloruros",
        "Cond, (ÂµS)": "cond_us",
        "pH": "ph",                  # ðŸ‘ˆ ESTA LÃNEA ES LA CLAVE
        "TDS (ppm)": "tds",
        "Temp (Â°C)": "temp_c",
        "Turb Cruda Ref (NTU)": "turb_cruda",
        "Caudal (mÂ³/h)": "caudal",
        "Dosis (ppm)": "dose",
        "Prom Turb Decant": "turb_decant",
        "Remoc decant (%)": "remoc_decant",
        "Remoc total (%)": "remoc_total",
    }
    df = df.rename(columns=rename_map)

    # ConversiÃ³n segura a float (maneja "," y "%")
    def to_float(series):
        return (
            series.astype(str)
            .str.replace(".", ".", regex=False)
            .str.replace(",", ".", regex=False)
            .str.replace("%", "", regex=False)
            .str.replace(" ", "", regex=False)
            .replace({"": np.nan, "nan": np.nan})
            .astype(float)
        )

    num_cols = [
        "alc",
        "cloruros",
        "cond_us",
        "ph",          # ðŸ‘ˆ AGREGAMOS ph A LA LIMPIEZA NUMÃ‰RICA
        "tds",
        "temp_c",
        "turb_cruda",
        "caudal",
        "dose",
        "turb_decant",
        "remoc_decant",
        "remoc_total",
    ]

    for c in num_cols:
        if c in df.columns:
            df[c] = to_float(df[c])

    # Filtrar filas con todo lo necesario
    needed = [
        "turb_cruda",
        "ph",
        "alc",
        "cloruros",
        "cond_us",
        "tds",
        "temp_c",
        "caudal",
        "dose",
        "turb_decant",
    ]
    df = df.dropna(subset=[col for col in needed if col in df.columns]).copy()

    return df


@st.cache_data(show_spinner=False)
def train_model():
    df = load_embedded_csv()

    feature_cols = [
        "turb_cruda",
        "ph",
        "alc",
        "cloruros",
        "cond_us",
        "tds",
        "temp_c",
        "caudal",
        "dose",
    ]
    X = df[feature_cols]
    y = df["turb_decant"]

    model = RandomForestRegressor(
        n_estimators=300,
        random_state=42,
        n_jobs=-1,
        max_depth=None,
    )
    model.fit(X, y)

    dose_min = float(df["dose"].min())
    dose_max = float(df["dose"].max())

    return model, feature_cols, (dose_min, dose_max), df


def build_curve(model, feature_cols, base_inputs, dose_min, dose_max, n_points=80):
    """Genera dosis y turbidez prevista usando el modelo ML."""
    doses = np.linspace(dose_min, dose_max, n_points)
    rows = []
    for d in doses:
        row = {
            "turb_cruda": base_inputs["turb_cruda"],
            "ph": base_inputs["ph"],
            "alc": base_inputs["alc"],
            "cloruros": base_inputs["cloruros"],
            "cond_us": base_inputs["cond_us"],
            "tds": base_inputs["tds"],
            "temp_c": base_inputs["temp_c"],
            "caudal": base_inputs["caudal"],
            "dose": d,
        }
        rows.append([row[col] for col in feature_cols])


    
    X_curve = np.array(rows)
    y_curve = model.predict(X_curve)
    return doses, y_curve



def fit_polynomial(doses, turb, degree):
    """Ajusta un polinomio de grado 'degree'."""
    coeffs = np.polyfit(doses, turb, degree)
    p = np.poly1d(coeffs)
    return p


def describe_polynomial(p):
    """Devuelve un string legible con la fÃ³rmula."""
    terms = []
    degree = p.order
    for i, c in enumerate(p.coeffs):
        pow_ = degree - i
        c_rounded = round(c, 5)
        if pow_ == 0:
            terms.append(f"{c_rounded}")
        elif pow_ == 1:
            terms.append(f"{c_rounded}Â·D")
        else:
            terms.append(f"{c_rounded}Â·D^{pow_}")
    expr = " + ".join(terms)
    return f"Turbidez_decantada(D) = {expr}"


def find_critical_points(p, x_min, x_max):
    """Encuentra mÃ­nimos locales e inflexiones dentro del rango [x_min, x_max]."""
    crit = {}

    # Derivada 1 -> posibles extremos
    dp = np.polyder(p, 1)
    roots = np.roots(dp)
    real_roots = [np.real(r) for r in roots if abs(np.imag(r)) < 1e-6]
    mins = []
    for r in real_roots:
        if x_min <= r <= x_max:
            # Segunda derivada
            d2p = np.polyder(p, 2)
            second = np.polyval(d2p, r)
            if second > 0:
                mins.append(float(r))
    crit["mins"] = mins

    # Derivada 2 -> inflexiones
    if p.order >= 2:
        d2p = np.polyder(p, 2)
        roots2 = np.roots(d2p)
        real_roots2 = [np.real(r) for r in roots2 if abs(np.imag(r)) < 1e-6]
        infl = [float(r) for r in real_roots2 if x_min <= r <= x_max]
    else:
        infl = []
    crit["infl"] = infl

    return crit


# ============================================================
#  APLICACIÃ“N STREAMLIT
# ============================================================

st.set_page_config(page_title="Dosis Ã³ptima PAC â€” Modelo polinÃ³mico", layout="wide")

st.title("Dosis Ã³ptima de PAC â€” Modelo polinÃ³mico sobre ML")
st.caption(
    "Datos histÃ³ricos embebidos en el cÃ³digo. "
    "Se entrena un modelo sobre turbidez decantada y se ajusta un polinomio "
    "Dosis vs Turbidez prevista para tus condiciones actuales."
)

with st.spinner("Entrenando modelo con datos embebidos..."):
    model, feature_cols, (dose_min, dose_max), df = train_model()

col_left, col_right = st.columns([2, 1])

with col_left:
    st.subheader("ParÃ¡metros de agua cruda y caudal")

    last_row = df.iloc[-1]

    turb_cruda = st.number_input(
        "Turbidez cruda (NTU)",
        value=float(last_row.get("turb_cruda", 50.0)),
    )
    ph = st.number_input(
        "pH (-)",
        value=float(last_row.get("ph", 7.2)),
        step=0.01,
        format="%.2f",
    )
    alc = st.number_input(
        "Alcalinidad (mg/L CaCOâ‚ƒ)",
        value=float(last_row.get("alc", 40.0)),
    )
    cloruros = st.number_input(
        "Cloruros (mg/L)",
        value=float(last_row.get("cloruros", 8.0)),
    )
    cond_us = st.number_input(
        "Conductividad (ÂµS/cm)",
        value=float(last_row.get("cond_us", 90.0)),
    )
    tds = st.number_input(
        "TDS (mg/L)",
        value=float(last_row.get("tds", 45.0)),
    )
    temp_c = st.number_input(
        "Temperatura (Â°C)",
        value=float(last_row.get("temp_c", 22.0)),
    )
    caudal = st.number_input(
        "Caudal (mÂ³/h)",
        value=float(last_row.get("caudal", 8000.0)),
    )

with col_right:
    st.subheader("ConfiguraciÃ³n del modelo")

    degree = st.slider(
        "Grado del polinomio (remociÃ³n vs dosis)",
        min_value=2,
        max_value=50,
        value=30,
        step=1,
    )

    rango_local = st.slider(
        "Rango de dosis para graficar (mg/L)",
        min_value=float(np.floor(dose_min)),
        max_value=float(np.ceil(dose_max)),
        value=(float(np.floor(dose_min)), float(np.ceil(dose_max))),
        step=0.5,
    )

if st.button("Calcular curva y mostrar resultados", type="primary"):       
        base_inputs = dict(
            turb_cruda=turb_cruda,
            ph=ph,
            alc=alc,
            cloruros=cloruros,
            cond_us=cond_us,
            tds=tds,
            temp_c=temp_c,
            caudal=caudal,
        )

        dmin, dmax = rango_local
        doses, turb_curve = build_curve(
            model, feature_cols, base_inputs, dmin, dmax, n_points=120
        )

        # Ajuste polinÃ³mico
        p = fit_polynomial(doses, turb_curve, degree)
        turb_poly = p(doses)

        # Puntos crÃ­ticos (mÃ­nimos e inflexiones) de la curva original
        crit = find_critical_points(p, dmin, dmax)
        mins = crit["mins"]
        infl = crit["infl"]

        # ----- GRÃFICA PRINCIPAL (YA LA TENÃAS) -----
        fig, ax = plt.subplots(figsize=(8, 5))
        ax.plot(doses, turb_curve, label="PredicciÃ³n ML", linewidth=1.5)
        ax.plot(
            doses,
            turb_poly,
            linestyle="--",
            label=f"Ajuste polinÃ³mico grado {degree}"
        )

        # Marcar mÃ­nimos de la curva original
        for m in mins:
            ax.scatter(m, p(m), s=60, marker="v")
            ax.annotate(
                f"mÃ­n â‰ˆ {m:.2f} mg/L\nT â‰ˆ {p(m):.2f} NTU",
                (m, p(m)),
                textcoords="offset points",
                xytext=(0, -35),
                ha="center",
                fontsize=8,
            )

        # Marcar puntos de inflexiÃ³n
        for x0 in infl:
            ax.scatter(x0, p(x0), s=60, marker="o")
            ax.annotate(
                f"inflecciÃ³n â‰ˆ {x0:.2f}",
                (x0, p(x0)),
                textcoords="offset points",
                xytext=(0, 10),
                ha="center",
                fontsize=8,
            )

        ax.set_xlabel("Dosis PAC (mg/L)")
        ax.set_ylabel("Turbidez decantada prevista (NTU)")
        ax.set_title("Curva Dosis vs Turbidez decantada")
        ax.grid(True, alpha=0.3)
        ax.legend()

        st.pyplot(fig)

               # ===== GRÃFICA: DERIVADA DE LA CURVA =====
               
        dp = np.polyder(p, 1)               # 1Âª derivada del polinomio (turbidez vs dosis)
        deriv_vals = dp(doses)              # valores de la derivada en cada dosis

        fig_der, ax_der = plt.subplots(figsize=(8, 3.5))
        ax_der.plot(doses, deriv_vals, linewidth=1.5, label="d(Turbidez) / d(Dosis)")
        ax_der.axhline(0, color="gray", linestyle="--", linewidth=1)

        # --- MÃ¡ximos y mÃ­nimos de la derivada ---
        # Condiciones:
        #  1) p''(D) = 0   -> raÃ­ces reales de la segunda derivada (derivada de la derivada).
        #  2) El punto estÃ© "bien dentro" del rango, no en los extremos.
        interior_margin = 0.05 * (dmax - dmin)   # por ejemplo, 5 % de margen en cada lado
        crit_der_points = []

        if p.order >= 3:
            d2p = np.polyder(p, 2)              # segunda derivada de p (derivada de la derivada)
            roots = np.roots(d2p)

            for r in roots:
                if abs(r.imag) < 1e-6:          # solo raÃ­ces reales
                    x0 = float(r.real)
                    # exigimos continuidad a izquierda y derecha dentro del rango:
                    if (dmin + interior_margin) <= x0 <= (dmax - interior_margin):
                        crit_der_points.append(x0)

        if crit_der_points:
            # tercera derivada para saber si es mÃ¡ximo o mÃ­nimo de la derivada
            d3p = np.polyder(p, 3)
            for x0 in crit_der_points:
                y0 = float(dp(x0))
                d3_val = float(np.polyval(d3p, x0))

                if d3_val < 0:
                    # mÃ¡ximo de la derivada
                    marker = "^"
                    texto = f"mÃ¡x deriv\nD â‰ˆ {x0:.2f}"
                    offset_y = 10
                else:
                    # mÃ­nimo de la derivada
                    marker = "v"
                    texto = f"mÃ­n deriv\nD â‰ˆ {x0:.2f}"
                    offset_y = -30

                ax_der.scatter(x0, y0, s=60, marker=marker)
                ax_der.annotate(
                    texto,
                    (x0, y0),
                    textcoords="offset points",
                    xytext=(0, offset_y),
                    ha="center",
                    fontsize=8,
                )

        ax_der.set_xlabel("Dosis PAC (mg/L)")
        ax_der.set_ylabel("Derivada de turbidez respecto a dosis")
        ax_der.set_title("Derivada de la curva dosisâ€“turbidez")
        ax_der.grid(True, alpha=0.3)
        ax_der.legend()

        st.pyplot(fig_der)

                # ===== GRÃFICA: SEGUNDA DERIVADA DE LA CURVA (p'') =====
        if p.order >= 4:
            d2p = np.polyder(p, 2)      # segunda derivada
            d3p = np.polyder(p, 3)      # tercera derivada
            d4p = np.polyder(p, 4)      # cuarta derivada

            d2_vals = d2p(doses)

            fig_d2, ax_d2 = plt.subplots(figsize=(8, 3.5))
            ax_d2.plot(doses, d2_vals, linewidth=1.5, label="dÂ²(Turbidez) / d(Dosis)Â²")
            ax_d2.axhline(0, color="gray", linestyle="--", linewidth=1)

            # --- buscar extremos locales de la segunda derivada ---
            margin = 0.05 * (dmax - dmin)   # margen interior
            crit_d2 = []

            roots_d3 = np.roots(d3p)
            for r in roots_d3:
                if abs(r.imag) < 1e-6:
                    x0 = float(r.real)
                    if (dmin + margin) <= x0 <= (dmax - margin):
                        crit_d2.append(x0)

            crit_d2 = sorted(crit_d2)

            for x0 in crit_d2:
                y0 = float(d2p(x0))
                d4_val = float(np.polyval(d4p, x0))

                if d4_val < 0:
                    marker = "^"
                    label = "mÃ¡x"
                    offset = 10
                elif d4_val > 0:
                    marker = "v"
                    label = "mÃ­n"
                    offset = -30
                else:
                    marker = "o"
                    label = "ext"
                    offset = 10

                ax_d2.scatter(x0, y0, s=60, marker=marker)
                ax_d2.annotate(
                    f"{label} dÂ²\nD â‰ˆ {x0:.2f}",
                    (x0, y0),
                    textcoords="offset points",
                    xytext=(0, offset),
                    ha="center",
                    fontsize=8,
                )

            ax_d2.set_xlabel("Dosis PAC (mg/L)")
            ax_d2.set_ylabel("Segunda derivada")
            ax_d2.set_title("Segunda derivada de la curva dosisâ€“turbidez")
            ax_d2.grid(True, alpha=0.3)
            ax_d2.legend()

            st.pyplot(fig_d2)

        else:
            st.info("El polinomio debe ser de grado â‰¥ 4 para analizar extremos de la segunda derivada.")



        # ----- FÃ“RMULA DEL POLINOMIO -----
        st.markdown("### FÃ³rmula del polinomio ajustado")
        st.code(describe_polynomial(p), language="text")

        if mins:
            st.success(
                "MÃ­nimos locales dentro del rango: "
                + ", ".join(f"{m:.2f} mg/L" for m in mins)
            )
        else:
            st.info("No se detectaron mÃ­nimos locales dentro del rango de dosis elegido.")

        if infl:
            st.caption(
                "Puntos de inflexiÃ³n (cambio de concavidad) dentro del rango: "
                + ", ".join(f"{x0:.2f} mg/L" for x0 in infl)
            )
        else:
            st.caption("No se detectaron puntos de inflexiÃ³n dentro del rango de dosis.")
            
            

